<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="predRupdate">
<title>Example of Validating a Model that Includes Spline Terms • predRupdate</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example of Validating a Model that Includes Spline Terms">
<meta property="og:description" content="predRupdate">
<meta property="og:image" content="https://glenmartin31.github.io/predRupdate/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">predRupdate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/predRupdate.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/predRupdate_splineIllustration.html">Example of Validating a Model that Includes Spline Terms</a>
    <a class="dropdown-item" href="../articles/predRupdate_technical.html">Technical Background to predRupdate</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/GlenMartin31/predRupdate/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Example of Validating a Model that Includes Spline Terms</h1>
                        <h4 data-toc-skip class="author">Glen P. Martin,
PhD; David Jenkins, PhD; Matthew Sperrin, PhD</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/GlenMartin31/predRupdate/blob/HEAD/vignettes/predRupdate_splineIllustration.Rmd" class="external-link"><code>vignettes/predRupdate_splineIllustration.Rmd</code></a></small>
      <div class="d-none name"><code>predRupdate_splineIllustration.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/GlenMartin31/predRupdate" class="external-link">predRupdate</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="preamble">Preamble<a class="anchor" aria-label="anchor" href="#preamble"></a>
</h2>
<p>A primary purpose of the <strong>predRupdate</strong> package is to
externally validate an existing (previously published) clinical
prediction model (CPM) on a new dataset. Sometimes the existing CPMs
will include spline terms as predictor variables for non-linear
associations. The aim of this vignette is to overview how to use
<strong>predRupdate</strong> to validate such a model, and is intended
to supplement other vignettes in the package
(<code><a href="../articles/predRupdate.html">vignette("predRupdate")</a></code>).</p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>The data, called <em>SYNPM</em>, used throughout this vignette are
available within the <strong>predRupdate</strong> package. See “?SYNPM”
for details of these data. In short, the data and models included in
<em>SYNPM</em> are synthetic, but for the purposes of this vignette, we
imagine that one is interested in predicting someone’s risk of mortality
after surgery. Data are available on 20000 people, which records each
individuals age, gender, smoking status, diabetes status, and Creatinine
value at the time of surgery. The data includes a binary outcome, Y,
indicating if the patient died within 1 month.</p>
<p>For this vignette, we imagine a situation where a CPM has previously
been developed (in another dataset) to predict the risk of mortality
within 1 month of surgery, and we wish to validate this model in our
dataset to test the predictive performance (e.g., an external validation
study). The existing model was a logistic regression model, with the
following predictor variables and coefficients (log-odds ratios)
reported:</p>
<table class="table">
<caption>Table of coefficients for the existing logistic regression
prediction model</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">Coefficient</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-3.99500</td>
</tr>
<tr class="even">
<td align="left">Age spline1</td>
<td align="right">0.72918</td>
</tr>
<tr class="odd">
<td align="left">Age spline2</td>
<td align="right">0.06249</td>
</tr>
<tr class="even">
<td align="left">Age spline3</td>
<td align="right">1.67003</td>
</tr>
<tr class="odd">
<td align="left">Age spline4</td>
<td align="right">0.75348</td>
</tr>
<tr class="even">
<td align="left">SexM</td>
<td align="right">0.47859</td>
</tr>
</tbody>
</table>
<p>The existing model included Age as a B-spline (of degree 3) with 4
degrees of freedom. The coefficient for each basis function is given in
the table above. The existing model reported that the internal knot
location was 50.09 years, with boundary knot locations of 36 and 64
years.</p>
<p>We now show how one can use this reported information to externally
validate the model in new data using <strong>predRupdate</strong>
package.</p>
</div>
<div class="section level2">
<h2 id="external-validation">External Validation<a class="anchor" aria-label="anchor" href="#external-validation"></a>
</h2>
<p>The first step in using <strong>predRupdate</strong> to validate this
model is to input the model information. We start by creating a
data.frame of the model coefficients, with the columns being the
predictor variable names. This information is then passed into the
<code><a href="../reference/pred_input_info.html">pred_input_info()</a></code> function to input the information about
the existing model. See <code><a href="../reference/pred_input_info.html">pred_input_info()</a></code> for details.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a data.frame of the model coefficients, with columns being variables</span></span>
<span><span class="va">coefs_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"Intercept"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">3.995</span>, <span class="co">#the intercept needs to be named exactly as given here</span></span>
<span>                          <span class="st">"Age_spline1"</span> <span class="op">=</span> <span class="fl">0.72918</span>,</span>
<span>                          <span class="st">"Age_spline2"</span> <span class="op">=</span> <span class="fl">0.06249</span>, </span>
<span>                          <span class="st">"Age_spline3"</span> <span class="op">=</span> <span class="fl">1.67003</span>,</span>
<span>                          <span class="st">"Age_spline4"</span> <span class="op">=</span> <span class="fl">0.75348</span>,</span>
<span>                          <span class="st">"SexM"</span> <span class="op">=</span> <span class="fl">0.47859</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#pass this into pred_input_info()</span></span>
<span><span class="va">Existing_Logistic_Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pred_input_info.html">pred_input_info</a></span><span class="op">(</span>model_type <span class="op">=</span> <span class="st">"logistic"</span>,</span>
<span>                                           model_info <span class="op">=</span> <span class="va">coefs_table</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">Existing_Logistic_Model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Information about 1 existing model(s) of type 'logistic' </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Coefficients </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt;   Intercept Age_spline1 Age_spline2 Age_spline3 Age_spline4    SexM</span></span>
<span><span class="co">#&gt; 1    -3.995     0.72918     0.06249     1.67003     0.75348 0.47859</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Functional Form </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt; Age_spline1 + Age_spline2 + Age_spline3 + Age_spline4 + SexM</span></span></code></pre></div>
<p>Next, we need to apply the B-spline function (exactly as originally
published for the existing model under validation) to our dataset. We
can do this in R using the <strong>splines</strong> package, and passing
in the knot locations as reported by the existing model development:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Age_spline</span> <span class="op">&lt;-</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></span><span class="op">(</span><span class="va">SYNPM</span><span class="op">$</span><span class="va">ValidationData</span><span class="op">$</span><span class="va">Age</span>,</span>
<span>                          knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50.09</span><span class="op">)</span>,</span>
<span>                          Boundary.knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">36</span>, <span class="fl">64</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Age_spline</span><span class="op">)</span></span>
<span><span class="co">#&gt;              1         2          3            4</span></span>
<span><span class="co">#&gt; [1,] 0.3274396 0.4868261 0.18474109 0.0000000000</span></span>
<span><span class="co">#&gt; [2,] 0.1739705 0.4823196 0.34237812 0.0013318088</span></span>
<span><span class="co">#&gt; [3,] 0.1847176 0.4873202 0.32718198 0.0007802354</span></span>
<span><span class="co">#&gt; [4,] 0.2026126 0.4936276 0.30350207 0.0002577483</span></span>
<span><span class="co">#&gt; [5,] 0.1404779 0.4598862 0.39461373 0.0050222206</span></span>
<span><span class="co">#&gt; [6,] 0.5795287 0.2856465 0.04120013 0.0000000000</span></span></code></pre></div>
<p>We can see that this creates the basis functions, which we add to out
validation dataset (taking care to name these columns the same as how
the corresponding coefficients for each basis function is specified in
above):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ValidationData</span> <span class="op">&lt;-</span> <span class="va">SYNPM</span><span class="op">$</span><span class="va">ValidationData</span></span>
<span><span class="va">ValidationData</span><span class="op">$</span><span class="va">Age_spline1</span> <span class="op">&lt;-</span> <span class="va">Age_spline</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">ValidationData</span><span class="op">$</span><span class="va">Age_spline2</span> <span class="op">&lt;-</span> <span class="va">Age_spline</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">ValidationData</span><span class="op">$</span><span class="va">Age_spline3</span> <span class="op">&lt;-</span> <span class="va">Age_spline</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">ValidationData</span><span class="op">$</span><span class="va">Age_spline4</span> <span class="op">&lt;-</span> <span class="va">Age_spline</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span></span></code></pre></div>
<p>Now, we can validate this model in our validation dataset by using
<code><a href="../reference/pred_validate.html">pred_validate()</a></code> as normal (see
<code><a href="../articles/predRupdate.html">vignette("predRupdate")</a></code>):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">validation_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pred_validate.html">pred_validate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Existing_Logistic_Model</span>,</span>
<span>                                    new_data <span class="op">=</span> <span class="va">ValidationData</span>,</span>
<span>                                    binary_outcome <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">validation_results</span><span class="op">)</span> <span class="co">#use summary() to obtain a tidy output summary of the model performance</span></span>
<span><span class="co">#&gt; Calibration Measures </span></span>
<span><span class="co">#&gt; --------------------------------- </span></span>
<span><span class="co">#&gt;                         Estimate Std. Err Lower 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Observed:Expected Ratio   2.9952   0.0188                        2.8869</span></span>
<span><span class="co">#&gt; Calibration Intercept     1.2097   0.0204                        1.1697</span></span>
<span><span class="co">#&gt; Calibration Slope         1.0555   0.0693                        0.9197</span></span>
<span><span class="co">#&gt;                         Upper 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Observed:Expected Ratio                        3.1076</span></span>
<span><span class="co">#&gt; Calibration Intercept                          1.2496</span></span>
<span><span class="co">#&gt; Calibration Slope                              1.1913</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Also examine the calibration plot, if produced. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Discrimination Measures </span></span>
<span><span class="co">#&gt; --------------------------------- </span></span>
<span><span class="co">#&gt;     Estimate Std. Err Lower 95% Confidence Interval</span></span>
<span><span class="co">#&gt; AUC   0.5854   0.0058                         0.574</span></span>
<span><span class="co">#&gt;     Upper 95% Confidence Interval</span></span>
<span><span class="co">#&gt; AUC                        0.5968</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall Performance Measures </span></span>
<span><span class="co">#&gt; --------------------------------- </span></span>
<span><span class="co">#&gt; Cox-Snell R-squared: -0.1282</span></span>
<span><span class="co">#&gt; Nagelkerke R-squared: -0.23</span></span>
<span><span class="co">#&gt; Brier Score: 0.1295</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Also examine the distribution plot of predicted risks.</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">validation_results</span><span class="op">$</span><span class="va">flex_calibrationplot</span></span></code></pre></div>
<p><img src="predRupdate_splineIllustration_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Glen P. Martin, David Jenkins, Matthew Sperrin.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
