<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="predRupdate">
<title>Introduction to the predRupdate package • predRupdate</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the predRupdate package">
<meta property="og:description" content="predRupdate">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">predRupdate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/predRupdate.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/predRupdate_technical.html">Technical Background to predRupdate</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/GlenMartin31/predRupdate/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to the predRupdate package</h1>
                        <h4 data-toc-skip class="author">Glen P. Martin,
PhD; David Jenkins, PhD; Matthew Sperrin, PhD</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/GlenMartin31/predRupdate/blob/HEAD/vignettes/predRupdate.Rmd" class="external-link"><code>vignettes/predRupdate.Rmd</code></a></small>
      <div class="d-none name"><code>predRupdate.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="preamble">Preamble<a class="anchor" aria-label="anchor" href="#preamble"></a>
</h2>
<p>The <strong>predRupdate</strong> package includes a set of functions
to aid in the validation of a clinical prediction model (CPM) on a given
dataset, and to apply various model updating and aggregation methods.
This vignette aims to overview, through examples, some common workflows
of using the <strong>predRupdate</strong> package. For a technical
vignette describing the methods underpinning the package, please see
<code><a href="../articles/predRupdate_technical.html">vignette("predRupdate_technical")</a></code>.</p>
<p>The package is focused on the situation where there is an existing
CPM (or multiple CPMs) that has been developed (e.g., a model published
in the literature), and one wishes to apply this model to a new dataset.
We foresee at least three use-cases: (1) where one wishes to externally
validate the existing CPM on the new data to tests the model’s
predictive performance, i.e., external validation; (2) where one wishes
to apply model updating methods to the existing CPM to ‘tailor’ it to
the new dataset; and (3) where there are multiple existing CPMs, and one
wishes to apply model aggregation (meta-modelling) methods to pool these
models into a single model for the new dataset. We therefore give three
examples below for each of these use cases.</p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>The data used throughout this vignette are available within the
package, called <em>SYNPM</em>. These data are available to users of
<strong>predRupdate</strong> after installing and loading the package.
See “?SYNPM” for details of these data. In short, the data and models
included in <em>SYNPM</em> are synthetic, but for the purposes of this
vignette, we imagine that one is interested in predicting someone’s risk
of mortality after surgery. Data are available on 20000 people, which
records each individuals age, gender, smoking status, diabetes status,
and Creatine value at the time of surgery. The data includes the
outcomes of “ETime” representing the time (months) between surgery and
either death or end-of-follow-up (5 months), whichever occurred first.
The variable “Status” indicates if the patient died (1) or was
right-censored (0), and Y denotes a binary variable indicating if the
patient died within 1 month.</p>
</div>
<div class="section level2">
<h2 id="example-1-validating-an-existing-prediction-model-on-new-data">Example 1: validating an existing prediction model on new data<a class="anchor" aria-label="anchor" href="#example-1-validating-an-existing-prediction-model-on-new-data"></a>
</h2>
<p>In this first example, we take a situation where a CPM has previously
been developed (in another dataset) to predict the risk of mortality
within 1 month of surgery, and we wish to validate this model in our
dataset to test the predictive performance (e.g., an external validation
study).</p>
<p>The existing model was a logistic regression model, with the
following predictor variables and coefficients (log-odds ratios):</p>
<table class="table">
<caption>Table of coefficients for the existing logistic regression
prediction model</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">Coefficient</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Intercept</td>
<td align="right">-3.995</td>
</tr>
<tr class="even">
<td align="left">Age</td>
<td align="right">0.012</td>
</tr>
<tr class="odd">
<td align="left">SexM</td>
<td align="right">0.267</td>
</tr>
<tr class="even">
<td align="left">Smoking_Status</td>
<td align="right">0.751</td>
</tr>
<tr class="odd">
<td align="left">Diabetes</td>
<td align="right">0.523</td>
</tr>
<tr class="even">
<td align="left">Creatine</td>
<td align="right">0.578</td>
</tr>
</tbody>
</table>
<p>The first step in using <strong>predRupdate</strong> to validate this
model is to input the model information. We start by creating a
data.frame of the model coefficients, with the columns being the
predictor variable names. This information is then passed into the
“pred_input_info()” function to input the information about the existing
model. See the help file of “pred_input_info()” for details.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a data.frame of the model coefficients, with columns being variables</span></span>
<span><span class="va">coefs_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"Intercept"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">3.4</span>, <span class="co">#the intercept needs to be named exactly as given here</span></span>
<span>                          <span class="st">"SexM"</span> <span class="op">=</span> <span class="fl">0.306</span>, </span>
<span>                          <span class="st">"Smoking_Status"</span> <span class="op">=</span> <span class="fl">0.628</span>,</span>
<span>                          <span class="st">"Diabetes"</span> <span class="op">=</span> <span class="fl">0.499</span>,</span>
<span>                          <span class="st">"Creatine"</span> <span class="op">=</span> <span class="fl">0.538</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#pass this into pred_input_info()</span></span>
<span><span class="va">Existing_Logistic_Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pred_input_info.html">pred_input_info</a></span><span class="op">(</span>model_type <span class="op">=</span> <span class="st">"logistic"</span>,</span>
<span>                                           model_info <span class="op">=</span> <span class="va">coefs_table</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">Existing_Logistic_Model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Information about 1 existing model(s) of type 'logistic' </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Coefficients </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt;   Intercept  SexM Smoking_Status Diabetes Creatine</span></span>
<span><span class="co">#&gt; 1      -3.4 0.306          0.628    0.499    0.538</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Functional Form </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt; SexM + Smoking_Status + Diabetes + Creatine</span></span></code></pre></div>
<p>Next we wish to apply this model to our dataset to calculate the
predicted risks for each individual, and then compare these predictions
with the observed outcomes to calculate predictive performance. This can
all be achieved with the “pred_validate()” function, as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pred_validate.html">pred_validate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Existing_Logistic_Model</span>,</span>
<span>              new_data <span class="op">=</span> <span class="va">SYNPM</span><span class="op">$</span><span class="va">ValidationData</span>,</span>
<span>              binary_outcome <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span></span></code></pre></div>
<p><img src="predRupdate_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; Calibration Measures </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt;                          Estimate Std. Err Lower 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Calibration-in-the-large   0.7548   0.0205                        0.7146</span></span>
<span><span class="co">#&gt; Calibration Slope          0.7018   0.0506                        0.6026</span></span>
<span><span class="co">#&gt;                          Upper 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Calibration-in-the-large                        0.7950</span></span>
<span><span class="co">#&gt; Calibration Slope                               0.8009</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Also examine the calibration plot, if produced. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Discrimination Measures </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt;     Estimate Std. Err Lower 95% Confidence Interval</span></span>
<span><span class="co">#&gt; AUC   0.5794   0.0058                        0.5681</span></span>
<span><span class="co">#&gt;     Upper 95% Confidence Interval</span></span>
<span><span class="co">#&gt; AUC                        0.5908</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall Performance Measures </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt; Cox-Snell R-squared: -0.0504</span></span>
<span><span class="co">#&gt; Nagelkerke R-squared: -0.0905</span></span>
<span><span class="co">#&gt; Brier Score: 0.1251</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Also examine the histogram of predicted risks.</span></span></code></pre>
<p>This produces a flexible calibration plot, along with outputting
various metrics of model calibration (e.g., calibration intercept and
slope), discrimination (e.g., area under the ROC curve) and overall
performance (e.g., R-squared). We can see that this model has poor
calibration (calibration plot deviating from the y=x line, with
calibration intercept and slope significantly different from 0 and 1,
respectively), and poor discrimination. One may wish to update this
model to the new dataset - see Example 2 below.</p>
<div class="section level3">
<h3 id="survival-analysis-model">Survival analysis model<a class="anchor" aria-label="anchor" href="#survival-analysis-model"></a>
</h3>
<p>The above example considered the validation of an existing CPM that
was based on logistic regression. <strong>predRupdate</strong> also
contains functionality to validate CPMs that are based on time-to-event
(survival) models (e.g. a Cox proportional hazards model). In such a
case, the baseline cumulative hazard of the model should also be
specified, along with the regression coefficients.</p>
<p>In many cases, the baseline cumulative hazard of an existing CPM will
not be reported in “full”, but rather estimates of the baseline
cumulative hazard will be given at set follow-up times. To use
<strong>predRupdate</strong>, users should specify the baseline
cumulative hazard at the times at which one wishes to make predictions
(or validate/update the model).</p>
<p>For example, suppose an existing CPM was developed using Cox
proportional hazards to predict time-to-death after surgery, with the
following predictor parameters (log hazard ratios):</p>
<table class="table">
<caption>Table of coefficients for the existing time-to-event regression
prediction model</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">Coefficient</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Age</td>
<td align="right">0.007</td>
</tr>
<tr class="even">
<td align="left">SexM</td>
<td align="right">0.225</td>
</tr>
<tr class="odd">
<td align="left">Smoking_Status</td>
<td align="right">0.685</td>
</tr>
<tr class="even">
<td align="left">Diabetes</td>
<td align="right">0.425</td>
</tr>
<tr class="odd">
<td align="left">Creatine</td>
<td align="right">0.587</td>
</tr>
</tbody>
</table>
<p>and with the following baseline cumulative hazard reported at
discrete times of months 1-5 post surgery:</p>
<table class="table">
<caption>Table of baseline cumulative hazard</caption>
<thead><tr class="header">
<th align="right">time</th>
<th align="right">hazard</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.0230191</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.0475351</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.0720775</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.0969976</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.1209202</td>
</tr>
</tbody>
</table>
<p>We can then use the “pred_validate()” function to validate this model
at 1, 2, 3, 4 or 5 months follow-up in the new dataset. To achieve this,
one follows a similar syntax to above for the logistic model. The main
difference is that one needs to specify a time during follow-up that
we’d like to validate the model against - this time must also be
available in the baseline cumulative hazard provided.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a data.frame of the model coefficients, with columns being variables</span></span>
<span><span class="va">coefs_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"Age"</span> <span class="op">=</span> <span class="fl">0.008</span>,</span>
<span>                          <span class="st">"SexM"</span> <span class="op">=</span> <span class="fl">0.257</span>,</span>
<span>                          <span class="st">"Smoking_Status"</span> <span class="op">=</span> <span class="fl">0.697</span>,</span>
<span>                          <span class="st">"Diabetes"</span> <span class="op">=</span> <span class="fl">0.310</span>,</span>
<span>                          <span class="st">"Creatine"</span> <span class="op">=</span> <span class="fl">0.636</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#pass this into pred_input_info()</span></span>
<span><span class="va">Existing_TTE_Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pred_input_info.html">pred_input_info</a></span><span class="op">(</span>model_type <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>                                      model_info <span class="op">=</span> <span class="va">coefs_table</span>,</span>
<span>                                      cum_hazard <span class="op">=</span> <span class="va">BH_table</span><span class="op">)</span> <span class="co">#where BH_table is the baseline hazard above</span></span>
<span></span>
<span><span class="co">#now validate against the time-to-event outcomes in the new dataset:</span></span>
<span><span class="fu"><a href="../reference/pred_validate.html">pred_validate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Existing_TTE_Model</span>,</span>
<span>              new_data <span class="op">=</span> <span class="va">SYNPM</span><span class="op">$</span><span class="va">ValidationData</span>,</span>
<span>              survival_time <span class="op">=</span> <span class="st">"ETime"</span>,</span>
<span>              event_indicator <span class="op">=</span> <span class="st">"Status"</span>,</span>
<span>              time_horizon <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="predRupdate_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; Calibration Measures </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt;                         Estimate Std. Err Lower 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Observed:Expected Ratio   1.1420   0.0113                        1.1171</span></span>
<span><span class="co">#&gt; Calibration Slope         0.7358   0.0280                        0.6810</span></span>
<span><span class="co">#&gt;                         Upper 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Observed:Expected Ratio                        1.1675</span></span>
<span><span class="co">#&gt; Calibration Slope                              0.7907</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Also examine the calibration plot, if produced. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Discrimination Measures </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt;           Estimate Std. Err Lower 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Harrell C   0.5819   0.0032                        0.5756</span></span>
<span><span class="co">#&gt;           Upper 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Harrell C                        0.5882</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Also examine the histogram of predicted risks.</span></span></code></pre>
<div class="section level4">
<h4 id="specifying-the-baseline-cumulative-hazard">Specifying the baseline cumulative hazard<a class="anchor" aria-label="anchor" href="#specifying-the-baseline-cumulative-hazard"></a>
</h4>
<p>In the above example, we assumed that the baseline cumulative hazard
of the existing CPM was available at discrete follow-up times. In some
situations, the entire baseline cumulative hazard curve may be
presented, or indeed a parametric form of the baseline cumulative hazard
may be provided. In such a situation, one should extract (from the plot)
or calculate (from the parametric form) the baseline cumulative hazard
at multiple follow-up times of interest (the times at which one wishes
to validate the model at).</p>
<p>Additionally, in some cases, the baseline cumulative hazard of an
existing survival (time-to-event) CPM may not be reported/available. In
such a situation, one can still use <strong>predRupdate</strong> to
validate such a model. However, only a limited number of metrics will be
produced (i.e., only those that require the linear predictor, not
absolute risk predictions at a given follow-up time). Specifically, the
observed:expected ration and the calibration plot will not be
produced.</p>
<p>For example, suppose the baseline cumulative hazard for the above
model was not available. We could validate this model using
<strong>predRupdate</strong> as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a data.frame of the model coefficients, with columns being variables</span></span>
<span><span class="va">coefs_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"Age"</span> <span class="op">=</span> <span class="fl">0.008</span>,</span>
<span>                          <span class="st">"SexM"</span> <span class="op">=</span> <span class="fl">0.257</span>,</span>
<span>                          <span class="st">"Smoking_Status"</span> <span class="op">=</span> <span class="fl">0.697</span>,</span>
<span>                          <span class="st">"Diabetes"</span> <span class="op">=</span> <span class="fl">0.310</span>,</span>
<span>                          <span class="st">"Creatine"</span> <span class="op">=</span> <span class="fl">0.636</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#pass this into pred_input_info()</span></span>
<span><span class="va">Existing_TTE_Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pred_input_info.html">pred_input_info</a></span><span class="op">(</span>model_type <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>                                      model_info <span class="op">=</span> <span class="va">coefs_table</span>,</span>
<span>                                      cum_hazard <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="co">#leave as NULL if the baseline not avaliable</span></span>
<span></span>
<span><span class="co">#now validate against the time-to-event outcomes in the new dataset:</span></span>
<span><span class="fu"><a href="../reference/pred_validate.html">pred_validate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Existing_TTE_Model</span>,</span>
<span>              new_data <span class="op">=</span> <span class="va">SYNPM</span><span class="op">$</span><span class="va">ValidationData</span>,</span>
<span>              survival_time <span class="op">=</span> <span class="st">"ETime"</span>,</span>
<span>              event_indicator <span class="op">=</span> <span class="st">"Status"</span>,</span>
<span>              time_horizon <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Predicted risks are not available for some models: limited calibration</span></span>
<span><span class="co">#&gt; metrics returned and no calibration plot produced</span></span>
<span><span class="co">#&gt; Calibration Measures </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt;                         Estimate Std. Err Lower 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Observed:Expected Ratio       NA       NA                            NA</span></span>
<span><span class="co">#&gt; Calibration Slope         0.7358    0.028                         0.681</span></span>
<span><span class="co">#&gt;                         Upper 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Observed:Expected Ratio                            NA</span></span>
<span><span class="co">#&gt; Calibration Slope                              0.7907</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Also examine the calibration plot, if produced. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Discrimination Measures </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt;           Estimate Std. Err Lower 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Harrell C   0.5819   0.0032                        0.5756</span></span>
<span><span class="co">#&gt;           Upper 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Harrell C                        0.5882</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Also examine the histogram of predicted risks.</span></span></code></pre></div>
<p>Here, we see that no calibration plot is produced, and the
observed:expected ratio is NA. A warning message is given to highlight
this.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="example-2-model-updating-on-new-data">Example 2: model updating on new data<a class="anchor" aria-label="anchor" href="#example-2-model-updating-on-new-data"></a>
</h2>
<p>In the validation of an existing logistic regression model in Example
1 above, we found that the existing model was miscalibrated in the new
data. One strategy to handle this is to apply model updating methods.
See <code><a href="../articles/predRupdate_technical.html">vignette("predRupdate_technical")</a></code> for a technical
discussion of these methods. We here choose to apply model
re-calibration; to do so, we can use the “pred_update()” function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a data.frame of the model coefficients, with columns being variables</span></span>
<span><span class="va">coefs_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"Intercept"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">3.4</span>,</span>
<span>                          <span class="st">"SexM"</span> <span class="op">=</span> <span class="fl">0.306</span>,</span>
<span>                          <span class="st">"Smoking_Status"</span> <span class="op">=</span> <span class="fl">0.628</span>,</span>
<span>                          <span class="st">"Diabetes"</span> <span class="op">=</span> <span class="fl">0.499</span>,</span>
<span>                          <span class="st">"Creatine"</span> <span class="op">=</span> <span class="fl">0.538</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#pass this into pred_input_info()</span></span>
<span><span class="va">Existing_Logistic_Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pred_input_info.html">pred_input_info</a></span><span class="op">(</span>model_type <span class="op">=</span> <span class="st">"logistic"</span>,</span>
<span>                                           model_info <span class="op">=</span> <span class="va">coefs_table</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#apply the pred_update function to update the model to the new dataset:</span></span>
<span><span class="va">Updated_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pred_update.html">pred_update</a></span><span class="op">(</span><span class="va">Existing_Logistic_Model</span>,</span>
<span>                             update_type <span class="op">=</span> <span class="st">"recalibration"</span>,</span>
<span>                             new_data <span class="op">=</span> <span class="va">SYNPM</span><span class="op">$</span><span class="va">ValidationData</span>,</span>
<span>                             binary_outcome <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span></span></code></pre></div>
<p>One could then validate this updated model using “pred_validate()”,
but given we have updated the model in the new data, then any such
performance estimates would need to be adjusted for in-sample optimism
(e.g., using cross-validation or bootstrap internal validation):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pred_validate.html">pred_validate</a></span><span class="op">(</span><span class="va">Updated_model</span>, </span>
<span>              new_data <span class="op">=</span> <span class="va">SYNPM</span><span class="op">$</span><span class="va">ValidationData</span>, </span>
<span>              binary_outcome <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span></span></code></pre></div>
<p><img src="predRupdate_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; Calibration Measures </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt;                          Estimate Std. Err Lower 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Calibration-in-the-large        0   0.0204                       -0.0400</span></span>
<span><span class="co">#&gt; Calibration Slope               1   0.0721                        0.8587</span></span>
<span><span class="co">#&gt;                          Upper 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Calibration-in-the-large                        0.0400</span></span>
<span><span class="co">#&gt; Calibration Slope                               1.1413</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Also examine the calibration plot, if produced. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Discrimination Measures </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt;     Estimate Std. Err Lower 95% Confidence Interval</span></span>
<span><span class="co">#&gt; AUC   0.5794   0.0058                        0.5681</span></span>
<span><span class="co">#&gt;     Upper 95% Confidence Interval</span></span>
<span><span class="co">#&gt; AUC                        0.5908</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall Performance Measures </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt; Cox-Snell R-squared: 0.0094</span></span>
<span><span class="co">#&gt; Nagelkerke R-squared: 0.0168</span></span>
<span><span class="co">#&gt; Brier Score: 0.1203</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Also examine the histogram of predicted risks.</span></span></code></pre>
<p>Similar functionality is available for time-to-event models.</p>
</div>
<div class="section level2">
<h2 id="example-3-model-aggregation-on-new-data">Example 3: model aggregation on new data<a class="anchor" aria-label="anchor" href="#example-3-model-aggregation-on-new-data"></a>
</h2>
<p>Sometimes, there are instances where multiple existing CPMs are
available for the same prediction task (e.g., existing models developed
across different countries). Here, model aggregation methods can be used
to pool these existing CPMs into a single model in the new data. See
<code><a href="../articles/predRupdate_technical.html">vignette("predRupdate_technical")</a></code> for a technical
discussion of these methods.</p>
<p>To implement this, we input the information about multiple models
into “pred_input_info()”; each row of the model_info parameter should be
the coefficients of the existing models. Any parameter that is not
included in a given CPM should have value NA, as shown below:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coefs_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">3.4</span>,</span>
<span>                                  <span class="st">"SexM"</span> <span class="op">=</span> <span class="fl">0.306</span>,</span>
<span>                                  <span class="st">"Smoking_Status"</span> <span class="op">=</span> <span class="fl">0.628</span>,</span>
<span>                                  <span class="st">"Diabetes"</span> <span class="op">=</span> <span class="fl">0.499</span>,</span>
<span>                                  <span class="st">"Creatine"</span> <span class="op">=</span> <span class="fl">0.538</span>,</span>
<span>                                  <span class="st">"Age"</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">4.748</span>,</span>
<span>                                  <span class="st">"SexM"</span> <span class="op">=</span> <span class="fl">0.196</span>,</span>
<span>                                  <span class="st">"Smoking_Status"</span> <span class="op">=</span> <span class="fl">0.492</span>,</span>
<span>                                  <span class="st">"Diabetes"</span> <span class="op">=</span> <span class="fl">0.350</span>,</span>
<span>                                  <span class="st">"Creatine"</span> <span class="op">=</span> <span class="fl">0.555</span>,</span>
<span>                                  <span class="st">"Age"</span> <span class="op">=</span> <span class="fl">0.049</span><span class="op">)</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">3.267</span>,</span>
<span>                                  <span class="st">"SexM"</span> <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                                  <span class="st">"Smoking_Status"</span> <span class="op">=</span> <span class="fl">0.477</span>,</span>
<span>                                  <span class="st">"Diabetes"</span> <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                                  <span class="st">"Creatine"</span> <span class="op">=</span> <span class="fl">0.444</span>,</span>
<span>                                  <span class="st">"Age"</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">multiple_mods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pred_input_info.html">pred_input_info</a></span><span class="op">(</span>model_type <span class="op">=</span> <span class="st">"logistic"</span>,</span>
<span>                                 model_info <span class="op">=</span> <span class="va">coefs_table</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">multiple_mods</span><span class="op">)</span></span>
<span><span class="co">#&gt; Information about 3 existing model(s) of type 'logistic' </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Coefficients </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;   Intercept  SexM Smoking_Status Diabetes Creatine</span></span>
<span><span class="co">#&gt; 1      -3.4 0.306          0.628    0.499    0.538</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;   Intercept  SexM Smoking_Status Diabetes Creatine   Age</span></span>
<span><span class="co">#&gt; 2    -4.748 0.196          0.492     0.35    0.555 0.049</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;   Intercept Smoking_Status Creatine</span></span>
<span><span class="co">#&gt; 3    -3.267          0.477    0.444</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Functional Form </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt; Model 1: SexM + Smoking_Status + Diabetes + Creatine</span></span>
<span><span class="co">#&gt; Model 2: SexM + Smoking_Status + Diabetes + Creatine + Age</span></span>
<span><span class="co">#&gt; Model 3: Smoking_Status + Creatine</span></span></code></pre></div>
<p>We can then use “pred_stacked_regression()” function to apply stacked
regression to pool these models into a single model for the new
dataset:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pred_stacked_regression.html">pred_stacked_regression</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">multiple_mods</span>,</span>
<span>                              new_data <span class="op">=</span> <span class="va">SYNPM</span><span class="op">$</span><span class="va">ValidationData</span>,</span>
<span>                              binary_outcome <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">SR</span><span class="op">)</span></span>
<span><span class="co">#&gt; Information about 1 existing model(s) of type 'logistic' </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Coefficients </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt;   Intercept    SexM Smoking_Status  Diabetes  Creatine        Age</span></span>
<span><span class="co">#&gt; 1 -5.283702 0.19404      0.3387584 0.3518871 0.4338846 0.05719899</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Functional Form </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt; SexM + Smoking_Status + Diabetes + Creatine + Age</span></span></code></pre></div>
<p>One could then validate this updated model using “pred_validate()”,
but given we have updated the model in the new data, then any such
performance estimates would need to be adjusted for in-sample optimism
(e.g., using cross-validation or bootstrap internal validation):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pred_validate.html">pred_validate</a></span><span class="op">(</span><span class="va">SR</span>, </span>
<span>              new_data <span class="op">=</span> <span class="va">SYNPM</span><span class="op">$</span><span class="va">ValidationData</span>, </span>
<span>              binary_outcome <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span></span></code></pre></div>
<p><img src="predRupdate_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; Calibration Measures </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt;                          Estimate Std. Err Lower 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Calibration-in-the-large        0   0.0204                       -0.0401</span></span>
<span><span class="co">#&gt; Calibration Slope               1   0.0581                        0.8861</span></span>
<span><span class="co">#&gt;                          Upper 95% Confidence Interval</span></span>
<span><span class="co">#&gt; Calibration-in-the-large                        0.0401</span></span>
<span><span class="co">#&gt; Calibration Slope                               1.1139</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Also examine the calibration plot, if produced. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Discrimination Measures </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt;     Estimate Std. Err Lower 95% Confidence Interval</span></span>
<span><span class="co">#&gt; AUC   0.5956   0.0058                        0.5842</span></span>
<span><span class="co">#&gt;     Upper 95% Confidence Interval</span></span>
<span><span class="co">#&gt; AUC                        0.6069</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall Performance Measures </span></span>
<span><span class="co">#&gt; ================================= </span></span>
<span><span class="co">#&gt; Cox-Snell R-squared: 0.0146</span></span>
<span><span class="co">#&gt; Nagelkerke R-squared: 0.0262</span></span>
<span><span class="co">#&gt; Brier Score: 0.1196</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Also examine the histogram of predicted risks.</span></span></code></pre>
<p>Similar functionality is available for time-to-event models.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Glen P. Martin, David Jenkins, Matthew Sperrin.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
